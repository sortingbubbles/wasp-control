\section{Επίλυση}

\subsection{Ανάλυση Βιβλιοθήκης JGAP}

Η υλοποίηση των εξελικτικών αλγορίθμων απαιτεί πολύ χρόνο και κόπο. Για αυτό το λόγο έχουν αναπτυχθεί διάφορες βιβλιοθήκες οι οποίες παρέχουν όλους τους βασικούς  μηχανισμούς για την υλοποίηση ενός εξελικτικού αλγορίθμου.

Μια τέτοια βιβλιοθήκη που επιτρέπει την ανάπτυξη εξελικτικών αλγορίθμων είναι η JGAP. Η βιβλιοθήκη αυτή έχει αναπτυχθεί στη γλώσσα Java και υποστηρίζει μεγάλη προσαρμοστικότητα χωρίς όμως αυτό να σημαίνει ότι είναι δύσκολη στη χρήση. Στην πραγματικότητα συμβαίνει το ακριβώς αντίθετο.

Παρέχει όλες τις απαραίτητες κλάσεις και μεθόδους οι οποίες μπορούν να χρησιμοποιηθούν για την εφαρμογή των εξελικτικών αρχών στις λύσεις των προβλημάτων. \cite{Meffert}

Για να αναπτυχθεί ένας γενετικός αλγόριθμος με τη χρήση της βιβλιοθήκης JGAP, θα πρέπει να πραγματοποιηθούν τα εξής βήματα: \cite{zotero-R7UV9N25}
\begin{enumerate}
  \item Σχεδιασμός χρωμοσώματος
  \item Υλοποίηση συνάρτησης καταλληλότητας
  \item Ορισμός των παραμέτρων
  \item Δημιουργία ενός πληθυσμού από υποψήφιες λύσεις
  \item Εξέλιξη του πληθυσμού
\end{enumerate}

Αξίζει λοιπόν να γίνει μια αναφορά για κάθε βήμα ξεχωριστά.

\subsubsection{Σχεδιασμός Χρωμοσώματος}

Όπως αναφέρθηκε, το χρωμόσωμα αναπαριστά μια υποψήφια λύση ενός προβλήματος και αποτελείται από πολλαπλά γονίδια. Τα γονίδια στην βιβλιοθήκη JGAP αναπαριστούν διακριτά χαρακτηριστικά της λύσης. Για αυτό το λόγο το πρώτο βήμα αφορά τον ορισμό του χρωμοσώματος. Δηλαδή στην ουσία γίνεται ο ορισμός των γονιδίων (genes).

Αυτό γίνεται με την υλοποίηση της διεπαφής Gene η οποία αντιπροσωπεύει ένα γονίδιο χρωμοσώματος. Τέτοιες κλάσεις είναι η IntegerGene, DoubleGene και άλλες.

Για την δημιουργία του χρωμοσώματος, τα γονίδια τοποθετούνται σε ένα πίνακα και στη συνέχεια δημιουργείται ένα αντικείμενο τύπου Chromosome το οποίο δέχεται σαν όρισμα το πίνακα με τα γονίδια.

\subsubsection{Υλοποίηση Συνάρτησης Καταλληλότητας}

Για την αξιολόγηση των χρωμοσωμάτων είναι αναγκαία η χρήση μιας συνάρτησης καταλληλότητας. Στη βιβλιοθήκη JGAP, αυτό επιτυχγάνεται με την δημιουργίας μιας κλάσης που επεκτείνει την ήδη υπάρχουσα αφηρημένη κλάση FitnessFunction.

Σε αυτήν θα πρέπει να υλοποιηθεί η μέθοδος evaluate, η οποία δέχεται σαν όρισμα ένα χρωμόσωμα και αναλόγως επιστρέφει την τιμή της καταλληλότητας του. Είναι προκαθορισμένο για τις τιμές που επιστρέφει η μέθοδος evaluate να μην είναι αρνητικές, άρα η τιμή της καταλληλότητας δεν θα πρέπει να είναι αρνητικός αριθμός.

\subsubsection{Ορισμός των Παραμέτρων}

Η βιβλιοθήκη JGAP προσφέρει για κάθε εξελικτικό αλγόριθμο μια πληθώρα από παραμετροποιήσεις και επιλογές. Οι παραμετροποιήσεις γίνονται με τη χρήση του αντικειμένου Configuration, το οποίο πρέπει να δημιουργείται πριν την εκτέλεση του αλγορίθμου.

Μερικές από τις σημαντικότερες αλλαγές που μπορούν να γίνουν μέσω του αντικειμένου Configuration, αφορούν τους γενετικούς τελεστές, τον τρόπο που θα δημιουργούνται οι τυχαίοι αριθμοί και τον τρόπο με τον οποίο θα υλοποιείται η φυσική επιλογή.

Για την διευκόλυνση των χρηστών, υπάρχει μια κλάση που ονομάζεται DefaultConfiguration και περιέχει τις προκαθορισμένες παραμέτρους.Ειδικότερα, για την επιλογή χρησιμοποιείται η κλάση BestChromosomesSelector και οι γενετικοί τελεστές της διασταύρωσης και μετάλλαξης έχουν τις τιμές 0.35 και 12 αντιστοίχως.

\subsubsection{Δημιουργία ενός Πληθυσμού από Υποψήφιες Λύσεις}

Αφού ολοκληρωθούν τα παραπάνω βήματα φτάνει η στιγμή που πρέπει να δημιουργηθεί ο αρχικός πληθυσμός των χρωμοσωμάτων, οποίος ονομάζεται γονότυπος. Για αυτό το λόγο η κλάση που χρησιμοποιείται για τη δημιουργία του πληθυσμού ονομάζεται Genotype.

Αυτή η κλάση περιέχει τη μέθοδο randomInitialGenotype η οποία δέχεται το αντικείμενο Configuration, το οποίο περιέχει όλες τις παραμέτρους μας και με βάση αυτό, δημιουργεί τον σωστό αριθμό χρωμοσωμάτων. Τις περισσότερες φορές είναι αναγκαία η δημιουργία ενός αρχικού πληθυσμού.

\subsubsection{Εξέλιξη του Πληθυσμού}

Το τελικό βήμα για την ολοκλήρωση του αλγορίθμου είναι η εξέλιξη του πληθυσμού. Αυτή πραγματοποιείται με το κάλεσμα της μεθόδου evolve η οποία βρίσκεται στη κλάση Genotype. Η εξέλιξη, δηλαδή το κάλεσμα της evolve μπορεί να πραγματοποιηθεί όσες φορές επιθυμεί ο χρήστης.

Η ανάκτηση του καλύτερου αποτελέσματος γίνεται με τη μέθοδο getFittestChromosome. Αυτή επιστρέφει το χρωμόσωμα με τη μεγαλύτερη καταλληλότητα, δηλαδή το αντικείμενο Chromosome που εμφάνισε τη μεγαλύτερη τιμή στη μέθοδο evaluate.

\subsection{Σενάριο Προβλήματος}

Μόλις αγοράσατε ένα σπίτι και ανακαλύπτετε ότι η σοφίτα του είναι γεμάτη από σφηκοφωλιές. Πριν μετακομίσετε στο νέο σας σπίτι αποφασίζετε να εξοντώσετε τις σφήκες. Επισκέπτεστε το κατάστημα της περιοχής σας το οποίο διαθέτει εντομοκτόνα αλλά βρίσκεται μόνο τρία (3) δοχεία τύπου «εντομο-βόμβας» τα οποία έχουν συγκεκριμένη
ακτίνα δράσης και πρέπει να τοποθετηθούν πολύ κοντά στη φωλιά για να εξοντώσουν τις σφήκες που βρίσκονται μέσα. Δυστυχώς τα 3 δοχεία δεν είναι αρκετά να εξοντώσουν όλες τις σφήκες της σοφίτας.

Ευτυχώς η τύχη σας βοηθάει και βρίσκετε:

\begin{itemize}
  \item  έναν χάρτη (σχήμα \ref{fig_waspNestsMap}) που άφησε ο προηγούμενος ιδιοκτήτης και ο οποίος περιγράφει την θέση που βρίσκονται οι φωλιές όπως επίσης και τον αριθμό σφηκών που διαθέτει κάθε φωλιά (χρησιμοποιώντας ένα πίνακα 100x100),
  \item έναν τύπο (εξίσωση \ref{eq_bugBomb}) πάνω στο δοχείο «εντομο-βόμβας» ο οποίος δίνει την σχέση απόστασης από την φωλιά και του ποσοστού των σφηκών οι οποίες εξοντώνονται.
      \begin{equation}\label{eq_bugBomb}
        K = n* \frac{dmax}{20*d+0.00001}
      \end{equation}
      όπου\\
      $K$: Πλήθος σφηκών που θα σκοτωθούν σε μία φωλιά\\
      $n$: Πλήθος υπαρχόντων σφηκών σε αυτή τη φωλιά\\
      $d$: Απόσταση βόμβας από αυτή τη φωλιά\\
      $dmax$: Η μέγιστη απόσταση μεταξύ δύο φωλιών\\
\end{itemize}

\begin{figure}[!t]
    \centering
    \begin{tikzpicture}
    	\begin{axis}[
            xlabel={x},
            ylabel={y},
            width = 0.8\columnwidth,
            %height = 0.8\columnwidth,
            colorbar,
            legend cell align = left,
            legend pos = north west,
            %colormap = {whiteblack}{gray(0cm) = (1); gray(1cm) = (0)},
            colorbar style = {title=Αριθμός Σφηκών, /tikz/.cd},
            font = \footnotesize]

            \addplot +[scatter, only marks, point meta=explicit] table [meta=wasps, col sep=comma] {./figures/waspNests.csv};
            \addlegendentry{Σφηκοφωλιά}
        \end{axis}
    \end{tikzpicture}
    \caption{Χάρτης σφηκοφωλιών}
    \label{fig_waspNestsMap}
\end{figure}

Η απόσταση μεταξύ δύο θέσεων του χάρτη υπολογίζεται από την εξίσωση \ref{eq_distance}
\begin{equation}\label{eq_distance}
    d = \sqrt{(x_{1}-x_{2})^2+(y_{1}-y_{2})^2}
\end{equation}

Στόχος είναι να βρεθεί η καλύτερη δυνατή τοποθέτηση των δοχείων έτσι ώστε να εξοντωθεί ο μεγαλύτερος αριθμός σφηκών.

\subsection{Ανάλυση Προβλήματος}

Το πρόβλημα που τίθεται προς λύση από τη μία πλευρά μπορεί να θεωρηθεί πρόβλημα μεγιστοποίησης, εάν θεωρήσει κανείς ότι το ζητούμενο του προβλήματος είναι η εξαγωγή του αριθμού των εξοντωμένων σφηκών. Με αυτή τη σκοπιά στη συνάρτηση καταλληλότητας επιλέγονται τα χρωμοσώματα που οδηγούν στη μεγαλύτερη τιμή, ενώ απορρίπτονται αυτά που εξάγουν μικρό αριθμό εξοντωμένων σφηκών.

Μπορεί όμως να θεωρηθεί εξίσου ως ένα πρόβλημα ελαχιστοποίησης, με το σκεπτικό ότι το ζητούμενο είναι η μείωση του συνολικού αριθμού σφηκών οι οποίες βρίσκονται στην σοφίτα. Έτσι, στη συνάρτηση καταλληλότητας επιλέγονται τα χρωμοσώματα που οδηγούν στο μικρότερο αριθμό σφηκών που επέζησαν μετά τις εκρήξεις και απορρίπτονται αυτά που άφησαν τον μεγαλύτερο αριθμό σφηκών ζωντανό.

Στην παρούσα εργασία προτιμήθηκε η πρώτη επιλογή, χωρίς αυτό να σημαίνει ότι είναι καλύτερη από την άλλη. Ο λόγος της επιλογής αυτής είναι καθαρά για λόγους ευκολίας ως προς τη χρήση της βιβλιοθήκης JGAP.

\subsection{Περιγραφή Λύσης}

Αρχικά, δημιουργήθηκαν οι κλάσεις WaspNest και Map\-Controller.

Η κλάση WaspNest κρατάει τις πληροφορίες της κάθε σφηκοφωλιάς (τοποθεσία και αριθμός σφηκών), ενώ επίσης παρέχει την μέθοδο killWasps(killedWasps); η οποία αφαιρεί από τον αριθμό των σφηκών της συγκεκριμένης φωλιάς τον αριθμό killedWasps. Σε περίπτωση που η διαφορά είναι $\leq 0$, τότε θεωρείται ότι η φωλιά δεν έχει καμία ζωντανή σφήκα.

Η κλάση MapController κρατάει σε έναν πίνακα όλες τις σφηκοφωλιές. Ενδιαφέρον παρουσιάζει η μέθοδος getBomb\-TotalKills(bomb); η οποία υπολογίζει πόσες σφήκες θα πεθάνουν συνολικά αν σκάσει η βόμβα bomb, και καλεί την μέθοδο killWasps(); της κάθε σφηκοφωλιάς ώστε να ενημερωθεί το πλήθος των ζωντανών σφηκών.

Επειδή το αποτέλεσμα του τύπου \ref{eq_bugBomb} εξαρτάται και από τον αριθμό των σφηκών που έχει η φωλιά, έχει σημασία η σειρά με την οποία θα σκάσουν οι βόμβες. Αυτός είναι και ο λόγος που είναι απαραίτητη η κλήση της μεθόδου killWasps(); όταν σκάει μια βόμβα. Ως εκ τούτου, είναι απαραίτητο να υπάρχει ένας τρόπος ο οποίος θα επαναφέρει τον αριθμό των σφηκών που περιέχει κάθε σφηκοφωλιά στην αρχική του κατάσταση. Για αυτόν τον λόγο δημιουργήθηκε η μέθοδος saveMap(); η οποία αποθηκεύει την κατάσταση του χάρτη και καλείται αμέσως μετά την αρχικοποίηση του χάρτη, και η μέθοδος restoreMap(); που επαναφέρει τον χάρτη σε προηγούμενή του κατάσταση και καλείται μετά τον υπολογισμό του συνολικού αριθμού σφηκών που εξοντώνουν οι τρεις βόμβες. Αυτό γίνεται έτσι ώστε η επόμενη πιθανή λύση του προβλήματος που θα αξιολογηθεί να μην επηρεαστεί από την προηγούμενη.

Όπως αναφέρθηκε και πριν, το πρώτο βήμα για την ανάπτυξη ενός γενετικού αλγορίθμου σε JGAP είναι ο σχεδιασμός του χρωμοσώματος. Στο συγκεκριμένο πρόβλημα, κάθε χρωμόσωμα αποτελείται από έξι γονίδια \textemdash{} δύο γονίδια για τις συντεταγμένες της κάθε βόμβας (σχήμα \ref{fig_chromosomeStructure}).

\begin{figure}[!t]
    \centering
    \begin{tabular}{|c|c|c|c|c|c|}
        \hline
        $x_1$ & $y_1$ & $x_2$ & $y_2$ & $x_3$ & $y_3$\\
        \hline
    \end{tabular}
    \caption{Δομή χρωμοσώματος}
    \label{fig_chromosomeStructure}
\end{figure}

Στη συνέχεια, πρέπει να οριστεί η συνάρτηση καταλληλότητας με την οποία θα αξιολογούνται τα χρωμοσώματα. Αυτό γίνεται στην κλάση στην μέθοδο evaluate της κλάσης WaspFitnessFunction. η οποία καλεί την μέθοδο getBombTotalKills(); για κάθε βόμβα και τέλος, επαναφέρει τον χάρτη στην αρχική του κατάσταση με την μέθοδο restoreMap();.

Οι σημαντικότερες παράμετροι που μπορούν να ρυθμιστούν στο JGAP είναι η μέθοδος επιλογής χρωμοσώματος, η πιθανότητα που μπορεί να συμβεί ανασυνδυασμός ή μετάλλαξη και αν θα χρησιμοποιηθεί ελιτισμός ή όχι.

Το JGAP προσφέρει αρκετούς τρόπους για την επιλογή των χρωμοσωμάτων. Κυριότερες από αυτές είναι ο BestChromosomesSelector που παίρνει τα καλύτερα $n$ χρωμοσώματα στην επόμενη γενιά \cite{BCS}, ο WeightedRouletteSelector που λειτουργεί όπως η επιλογή ρουλέτας που αναφέρθηκε προηγουμένως \cite{WRS}, και ο TournamentSelector που λειτουργεί με παρόμοιο τρόπο με την επιλογή τουρνουά \cite{TS}. Για να διαπιστωθεί ποιος από τους τρεις τρόπους επιλογής δίνει καλύτερα αποτελέσματα, πραγματοποιήθηκαν τρία διαφορετικά πειράματα, όπου στο κάθε πείραμα έμεινε σταθερό το μέγεθος του πληθυσμού και ο μέγιστος αριθμός γενεών (100 και 1000 αντίστοιχα), και άλλαζε ο τρόπος επιλογής του χρωμοσώματος. Το κάθε πείραμα έτρεξε 100 φορές, και μετά πάρθηκε ο μέσος όρος της καταλληλότητας του καλύτερου χρωμοσώματος ανά γενιά, για κάθε τρόπο επιλογής (σχήμα \ref{fig_selectorFitness}). Όπως φαίνεται, ο BestChromosomesSelector και TournamentSelector είχαν σχεδόν ίδιες επιδόσεις, ενώ ο WeightedRouletteSelector άργησε να συγκλίνει σε μια καλύτερη λύση.

\begin{figure}[!t]
    \centering
    \begin{tikzpicture}
        \begin{axis}[
            xlabel={Αριθμός γενιάς},
            ylabel={Καταλληλότητα},
            %ymin = 2300,
            legend cell align = left,
            legend pos = south east,
            font = \footnotesize]

            \addplot +[mark=none] table [x=gen, y=bestchrom, col sep=comma] {./figures/selectors.csv};
            \addlegendentry{BestChromosomesSelector}
            \addplot +[mark=none] table [x=gen, y=roulette, col sep=comma] {./figures/selectors.csv};
            \addlegendentry{WeightedRouletteSelector}
            \addplot +[mark=none] table [x=gen, y=tournament, col sep=comma] {./figures/selectors.csv};
            \addlegendentry{TournamentSelector}
        \end{axis}
    \end{tikzpicture}
    \caption{Μέσος όρος καλύτερου fitness value ανά γενιά}
    \label{fig_selectorFitness}
\end{figure}

Με τον ίδιο τρόπο δοκιμάστηκε το πως επηρεάζει το μέγεθος του πληθυσμού την τιμή της καλύτερης καταλληλότητας ανά γενιά (σχήμα \ref{fig_avgFitness}). Παρατηρείται ότι όσο πιο μεγάλος ο πληθυσμός, τόσο καλύτερη λύση βρίσκεται.

\begin{figure}[!t]
    \centering
    \begin{tikzpicture}
        \begin{axis}[
            xlabel={Αριθμός γενιάς},
            ylabel={Καταλληλότητα},
            %ymin = 2300,
            legend cell align = left,
            legend pos = south east,
            font = \footnotesize]

            \addplot +[mark=none] table [x=gen, y=pop20, col sep=comma] {./figures/averageFitness.csv};
            \addlegendentry{πληθ. = 20}
            \addplot +[mark=none] table [x=gen, y=pop50, col sep=comma] {./figures/averageFitness.csv};
            \addlegendentry{πληθ. = 50}
            \addplot +[mark=none] table [x=gen, y=pop100, col sep=comma] {./figures/averageFitness.csv};
            \addlegendentry{πληθ. = 100}
            \addplot +[mark=none] table [x=gen, y=pop1000, col sep=comma] {./figures/averageFitness.csv};
            \addlegendentry{πληθ. = 1000}
        \end{axis}
    \end{tikzpicture}
    \caption{Μέσος όρος καλύτερου fitness value ανά γενιά}
    \label{fig_avgFitness}
\end{figure}

Τέλος, δοκιμάστηκε η αλλαγή της πιθανότητας του να συμβεί ανασυνδυασμός σε διάφορες ρυθμίσεις (σχήμα \ref{fig_crossover}).

\begin{figure}[!t]
    \centering
    \begin{tikzpicture}
        \begin{axis}[
            xlabel={Πιθανότητα ανασυνδυασμού},
            ylabel={Καταλληλότητα},
            ymin = 2300,
            legend cell align = left,
            legend pos = south east,
            font = \footnotesize]

            \addplot +[mark=none] table [x=a, y=b, col sep=comma] {./figures/crossoverRateFitness.csv};
            \addlegendentry{πληθ. = 50, γεν. = 5}
            \addplot +[mark=none] table [x=a, y=c, col sep=comma] {./figures/crossoverRateFitness.csv};
            \addlegendentry{πληθ. = 50, γεν. = 10}
            \addplot +[mark=none] table [x=a, y=d, col sep=comma] {./figures/crossoverRateFitness.csv};
            \addlegendentry{πληθ. = 20, γεν. = 5}
            \addplot +[mark=none] table [x=a, y=e, col sep=comma] {./figures/crossoverRateFitness.csv};
            \addlegendentry{πληθ. = 20, γεν. = 10}
        \end{axis}
    \end{tikzpicture}
    \caption{Μέσος όρος καλύτερου fitness value καθώς μεγαλώνει το ποσοστό ανασυνδυασμού}
    \label{fig_crossover}
\end{figure}

Αξίζει να σημειωθεί εδώ ότι η βέλτιστη λύση είναι να σκοτωθούν 3054 σφήκες\footnote{Βρέθηκε με μέθοδο εξαντλητικών δοκιμών. Ο κώδικας μπορεί να βρεθεί εδώ: https://github.com/sortingbubbles/wasp-control/tree/bruteforce}, αλλά καμία από τις λύσεις που βρέθηκαν δεν ήταν η βέλτιστη λύση (πολλές φορές όμως ήταν πολύ κοντά στην βέλτιστη). 